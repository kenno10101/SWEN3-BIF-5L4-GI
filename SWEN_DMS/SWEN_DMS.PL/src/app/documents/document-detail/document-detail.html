<section class="detail-wrapper">
  <a routerLink="/" class="back-link">← Back to overview</a>

  @if (loading) {
    <div class="state-text">Loading document...</div>
  }

  @if (error) {
    <div class="state-text error">{{ error }}</div>
  }

  @if (!loading && !error && document) {
    <article class="detail-card">
      <header class="detail-header">
        <h2>{{ document.fileName }}</h2>
        <div class="detail-meta-top actions-row">
          <span class="badge">Document Detail</span>
          <span class="detail-date">
            Uploaded on {{ document.uploadedAt | date: 'short' }}
          </span>
        </div>
        <div class="detail-meta-top">
          <button
          type="button"
          class="delete-btn"
          (click)="deleteDocument()"
          title="Delete document">
          Delete
        </button>
        </div>
      </header>

      <div class="detail-body">
        <div class="detail-block">
          <h3>Summary</h3>
          <p>
            {{ document.summary || 'No summary available.' }}
          </p>
        </div>

        <div class="detail-block">
          <h3>Tags</h3>
          @if (document.tags) {
            <div class="tags">
              <!-- simple: alles als ein Tag; später splittbar -->
              <span class="tag">{{ document.tags }}</span>
            </div>
          } @else {
            <p class="muted">No tags available.</p>
          }
        </div>

        <div class="detail-block">
          <h3>Document-ID</h3>
          <p class="doc-id">
            {{ document.id }}
          </p>
        </div>
      </div>
      <div class="detail-block notes-block">
        <h3>Notes</h3>

        <div class="note-create">
          <input
            class="note-input"
            type="text"
            placeholder="Add a note..."
            [(ngModel)]="noteContent"
            (keyup.enter)="addNote()"
          />
          <button type="button" class="details-btn" (click)="addNote()">Add</button>
        </div>

        @if (notesLoading) {
          <div class="state-text">Loading notes...</div>
        }

        @if (notesError) {
          <div class="state-text error">{{ notesError }}</div>
        }

        @if (!notesLoading && !notesError && notes.length) {
          <ul class="notes-list">
            @for (n of notes; track n.id) {
              <li class="note-item">
                <div class="note-content">{{ n.content }}</div>
                <div class="note-meta">
                  <span>{{ n.createdAtUtc | date: 'short' }}</span>
                  <button type="button" class="delete-btn note-delete-btn" (click)="deleteNote(n.id)">Delete</button>
                </div>
              </li>
            }
          </ul>
        }

        @if (!notesLoading && !notesError && !notes.length) {
          <p class="muted">No notes yet.</p>
        }
      </div>

    </article>
  }

  @if (!loading && !error && !document) {
    <div class="state-text error">
      Document not found.
    </div>
  }
</section>
